---
import Layout from '../../layouts/Layout.astro';
import '../../styles/global.css'
import Navbar from '../../components/Navbar.astro';
import SourceCodeButton from "../../components/SourceCodeButton.astro"
import Footer from '../../components/Footer.astro';

export async function getStaticPaths() {
    const allprojects = await Astro.glob('../../projects/*{md,mdx}');
	const projects = allprojects.filter((project) => !project.frontmatter.draft && project.frontmatter.slug);

	return projects.map((project) => ({
		params: {
			slug: project.frontmatter.slug,
		},
		props: { project },
	}));
}

const { project } = Astro.props;
const headings = await project.getHeadings(); 
---

<head>
    <meta charset="utf-8" />

    <!-- katex style -->
    <!-- TODO: replace with self hosted css -->
    <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css"
        integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ"
        crossorigin="anonymous"
    />
</head>

<Navbar page=project.slug />
<div class="articleContainer">
    <div class="article">
        <Layout title={project.frontmatter.title}>
            <div class="header">
                <div class="titles">
                    <h1>{project.frontmatter.title}</h1>
                    <h2>{project.frontmatter.description}</h2>
                </div>
                {project.frontmatter.link && <SourceCodeButton src={project.frontmatter.link} />}
            </div>

            <div class="project-markdown">
                <project.Content />
            </div>
        </Layout>
    </div>
    <div class="sideBar">
        <div class="box">
            <h3> Description </h3>
            <p>{project.frontmatter.description}</p>
        </div>
        <!-- <div class="box"> -->
        <!-- <h3> Toolsets </h3> -->
        <!-- <p>Python, Maya, PyMel</p> -->
        <!-- </div> -->
        <div class="box">
            <h3> Table of Contents </h3>
            {headings
                .filter(h => h.depth <= 3)
                .map(h => (
            <a href={`#${h.slug}`}><p>{h.text}</p></a>
                ))
            }
        </div>
        <!-- <h3> Lines of Code </h3> -->
        <!-- <p>368</p> -->
    </div>
</div>
<Footer/>

<style>
    .sideBar
    {
        position: sticky;
        top: 70px;
        display: flex;
        flex-direction: column;

        justify-content: flex-start;

        width: 300px;
        height: fit-content;
        background: none;
    }

    .sideBar .box
    {
        background: #1c2124;
        padding: 5px;
        border-radius: 10px;
        border: 1px solid #46474b;
        margin: 5px;
    }

    .sideBar a
    {
        color: inherit;
        text-decoration: none;
    }

    .articleContainer
    {
        display: flex;

        justify-content: center;
    }

    .header
    {
        display: flex;
        flex-direction: row;

        justify-content: space-between;

        margin-bottom: 40px;
    }

    h1, h2, p
    {
		font-family: Inter, Roboto, 'Helvetica Neue', 'Arial Nova', 'Nimbus Sans', Arial, sans-serif;
        padding: 0;
        margin: 0;
	}

    h1
    {
		/* background: linear-gradient(14deg, #5a189a 0%, #bf00ff 100%); */
		/* -webkit-background-clip: text; */
		/* -webkit-text-fill-color: transparent; */
		background-clip: text;
        /* filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.1)); */
        font-size: 2.4rem;
        font-weight: bold;
        display: inline-block;
    }

    h2 {
        margin: 0 0 1em;
        font-weight: normal;
        font-size: 20px;
    }


    body, html
    {
		min-height: 100vh;
        width: 100%;
        background: #181c1e;
    }

    .article 
    {
        padding:1em;
        background: #181c1e;
		min-height: 90vh;
        width: clamp(100px, 100%, 830px);
    }
</style>

<style is:global>
    .project-markdown video
    {
        width: 100%;
    }

	.project-markdown {
		font-family: Inter, Roboto, 'Helvetica Neue', 'Arial Nova', 'Nimbus Sans', Arial, sans-serif;
	}

    .project-markdown body {
        font-family: Helvetica, Arial, Freesans, clean, sans-serif;
        padding:1em;
        margin:auto;
    }

    .project-markdown h1, h2, h3, h4, h5, h6 {
        font-weight: bold;
    }

    .project-markdown p
    {
        font-size: 16px;
        text-align: justify;
    }

    .project-markdown h1 {
        color: white;
        font-size: 28px;
    }

    .project-markdown h2 {
        /* border-bottom: 3px solid rgba(255,255,255,0.1); */
        color: white;
        font-size: 24px;

        margin-top: 30px;
    }

    .project-markdown h3 {
        font-size: 18px;
    }

    .project-markdown h4 {
        font-size: 16px;
    }

    .project-markdown h5 {
        font-size: 14px;
    }

    .project-markdown h6 {
        color: white;
        background-color: inherit;
        font-size: 14px;
    }

    .project-markdown hr {
        height: 0.2em;
        border: 0;
        color: white;
        background-color: #CCCCCC;
    }

    .project-markdown p, blockquote, ul, ol, dl, li, table, pre {
        margin: 15px 0;
        color: white;
    }

    .project-markdown code, pre {
        border-radius: 3px;
        color: inherit;
    }

    .project-markdown code {
        border: 1px solid #3c4244;
        margin: 0 2px;
        padding: 0 5px;
    }

    .project-markdown pre {
        border: 1px solid #3c4244;
        line-height: 1.25em;
        overflow: auto;
        padding: 6px 10px;
    }

    .project-markdown pre > code {
        border: 0;
        margin: 0;
        padding: 0;
    }
    .project-markdown a, a:visited {
        color: #4183C4;
        background-color: inherit;
        text-decoration: none;
    }
</style>
